language: c

#
# Try building on these 4 architectures; all are 64-bit, and all but
# "s390x", a/k/a z/Architecture, are little-endian.
#

os:
  - linux

dist: focal

cache: ccache

jobs:
  fast_finish: true
  include:
  - name: "arm64"
    arch: arm64
    if: branch IN (master, libpcap-1.10)
  - name: "ppc64le"
    arch: ppc64le
    if: branch IN (master, libpcap-1.10)
  - name: "s390x"
    arch: s390x
    if: branch IN (master, libpcap-1.10)
  allow_failures:
    - arch: ppc64le # Since 20 Feb 2021 often times out trying to boot.

env:
  global:
    - MAKEFLAGS='-j 2' # Travis CI VMs come with 2 cores

addons:
  apt:
    packages:
      - libdbus-1-dev
      - libbluetooth-dev
      - libnl-genl-3-dev
      - libibverbs-dev

git:
  quiet: true
  depth: 3

before_install:
  - uname -a
  - date
  - if [ "$TRAVIS_OS_NAME" = linux ]; then apt list --installed 'lib*-dev'; fi

install:

before_script:

script:
  - ./build_matrix.sh
